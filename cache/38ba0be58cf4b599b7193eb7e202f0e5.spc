a:4:{s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"feed";a:1:{i:0;a:6:{s:4:"data";s:0:"";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:59:"
    <div lang="en" dir="ltr">Sitepatching updates</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:8:"subtitle";a:1:{i:0;a:5:{s:4:"data";s:98:"
    <div lang="en" dir="ltr">tweaking the broken code until it works, one site at a time</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:4:"link";a:2:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:33:"http://my.opera.com/sitepatching/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:2:{s:3:"rel";s:4:"self";s:4:"href";s:46:"http://my.opera.com/sitepatching/xml/atom/blog";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:16:"Sitepatching    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:38:"http://my.opera.com/sitepatching/blog/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-03-01T21:23:11Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:5:"entry";a:6:{i:0;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:62:"
    <div lang="en" dir="ltr">10.50 browser.js update</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:18:"Ola P. Kleiven    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/8357151";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/8357151";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-03-01T21:23:11Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:2189:"<div lang="en" dir="ltr">It&#039;s been a while since the last browser.js update on this blog - 1 short month to be exact. This isn&#039;t as big as the last change but some nice ones anyway:
<br>
<br><span style="font-size: medium">New patches</span>
<br><a href="http://bild.de/" target="_blank">bild.de</a> image galleries - a little workaround for an Opera bug with mouse events on transparent elements. The bug has always been there but became more visible after we fixed another bug earlier this year.
<br>
<br><a href="http://blogger.com/" target="_blank">blogger.com</a> post submit failed - work around an issue that came about because Opera spoofs as Mozilla on Blogger to work at all. Makes sure the click() method is on the button.
<br>
<br><a href="http://forums.xbox.com/" target="_blank">forums.xbox.com</a> can&#039;t be scrolled - Opera has trouble with extremely tall or wide elements, sometimes causing scrolling to be disabled.
<br>
<br><a href="http://pb.yamada-denki.jp" target="_blank"><a href="http://pb.yamada-denki.jp" target="_blank">http://pb.yamada-denki.jp</a></a> pamphlets not showing - work around Opera sniffing.
<br>
<br><a href="http://social.microsoft.com" target="_blank">social.microsoft.com</a> forum editor hangs - work around a combination of document.domain and TinyMCE.
<br>
<br>
<br>
<br><span style="font-size: medium">Changed patches</span>
<br>softbank.jp login fails - obsoleted by a core fix for not caching certain elements without cache headers.
<br>
<br><a href="http://mail.live.com" target="_blank">mail.live.com</a> - removed a sub patch where Opera wouldn&#039;t allow setting a style value to null. Fixed in core.
<br>
<br>
<br>
<br><span style="font-size: medium">Removed patches</span>
<br>Google Gears compatibility layer - Gears isn&#039;t supported in Opera desktop anyway so this has little mission.
<br>
<br>Missing submit button on yahoo.co.jp auctions - obsoleted by core fix handling invalid markup
<br>
<br>Apple store locator missing text - they changed service provider so site doesn&#039;t exist like it did.
<br>
<br><a href="http://klm.com/" target="_blank">klm.com</a> menus fail to expand - site redesigned.</div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}i:1;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:82:"
    <div lang="en" dir="ltr">New Java plug-in support and object parsing</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:18:"Ola P. Kleiven    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/8215741";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/8215741";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-02-25T21:48:12Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:1239:"<div lang="en" dir="ltr">10.50 introduces support for <a href="https://jdk6.dev.java.net/plugin2/" target="_blank">Java plugin2</a> and at the same time changes parsing of object tags to be in line with <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-iframe-element.html#the-object-element" target="_blank">HTML5</a>
<br>
<br>This topic isn&#039;t strictly about sitepatching but will change site compatibility. Mostly for the better but there could be unexpected side effects on sites that expect certain behavior - thus becoming targets for site patching. More on that later.
<br>
<br>Let&#039;s take the last first, object parsing. Assume the following quite typical markup (simplified):
<br>
<br><pre>
&lt;object classid=&quot;clsid:CAFEEFAC-0016-0000-FFFF-ABCDEFFEDCBA&quot;&gt;
 &lt;param name=&quot;code&quot; value=&quot;foo.class&quot;&gt;
 &lt;embed type=&quot;application/x-java-applet&quot; code=&quot;foo.class&quot;&gt;
&lt;/object&gt;
</pre>
<br>
<br>The object is here meant for IE. IE recognizes the classid and invokes the Java ActiveX control based on it. Other browsers don&#039;t understand the object and fall back to using the embed where there is a type attribute they can understand.</div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}i:2;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:53:"
    <div lang="en" dir="ltr">Ready to Wave?</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:18:"Ola P. Kleiven    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/7407581";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/7407581";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-02-05T18:47:03Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:280:"<div lang="en" dir="ltr">With the latest <a href="http://my.opera.com/desktopteam/blog/2010/02/05/skin-fixes-unite-and-then-some" target="_blank">snapshot</a> we have killed some more bugs in the new Carakan JS engine, including a couple required to get Google Wave to work.</div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}i:3;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:77:"
    <div lang="en" dir="ltr">browser.js for 10.5: the giant cleanup</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:25:" Hallvord R. M. Steen    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/7233791";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/7233791";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-02-01T19:45:27Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:16944:"<div lang="en" dir="ltr">During the last two weeks, browser.js has been tested against Opera 10.5, and the updates both on bug fixing and on handling broken code means an unprecedented number of patches are now due for removal. :D 
<br>
<br>WARNING: This is probably the longest browser.js update post ever!
<br>
<br><strong>This post is evidence of remarkable progress on the bug fixing and site compatibility front</strong>. Whether we were talking plain bugs or errors due to Opera&#039;s handling of unexpected code or spec violations, Opera 10.5 contains the results of man-years of analysis and bug fixing, hopefully taking a great leap forward for site compatibility. (Unless Carakan, Vega and the rest of the new and exciting stuff brings a heap of NEW bugs that break websites, that is.. Time will show ;))
<br>
<br>
<br><h2>New patches</h2>
<br>
<br><strong>Added - <a href="http://www.pchome.net" target="_blank">pchome.net</a> layout fix</strong>
<br>Layout issue caused by a margin pushing floats out of their expected position. This is already fixed in core for 10.5.
<br>
<br><strong>Added - <a href="http://mail.yahoo.com">Y!Mail</a> chat enter fix</strong>
<br>This issue was <a href="http://my.opera.com/community/forums/topic.dml?id=288637&amp;t=1265045705&amp;page=1#comment3106971">reported in the fora</a> and prompted by <a href="http://my.opera.com/sitepatching/blog/2010/01/11/patches-of-the-week-allrecipes-com-and-ebay-whitespace#comment15651521">the first comment</a> on the previous blog post I had a quick look. Turns out it was caused by a familiar problem..
<br>
<br>Back when we implemented the much-requested rich text editing support, we weren&#039;t quite sure what scripts should be allowed to run inside a document with designMode enabled. (Before you ask - no, there was no spec for designMode back then. It&#039;s something browser vendors invented, and it&#039;s still plagued with crippling interoperability problems. HTML5 is going to handle at least some of it but I assume something as complex as rich text editing will remain underspecified for a while..)
<br>
<br>Our testing back then indicated that other browsers stopped running scripts inside a document when designMode was enabled. Depending on the context, running scripts when a site doesn&#039;t expect you to can cause cross-site scripting exploits and similar security problems, so we made really sure we blocked script execution in editing mode. So far, so good... except that&#039;s <i>not</i> what the others are doing. Several broken sites later we realised that they still allow event listeners (like those added with <strong>document.addEventListener(&#039;keyup&#039;, ..)</strong> to run.
<br>
<br>So because of this misunderstanding we don&#039;t send the event to Yahoo, and thus enter doesn&#039;t send your chat message. The patch works around that by making designMode sort of an alias for contentEditable, which does not disable scripts.
<br>
<br><strong>Added - <a href="http://www.toshiba.co.jp">Toshiba </a>script hang fix</strong>
<br>A while ago, I noticed a site setting innerHTML to a markup string with an OBJECT loading Flash content and immediately trying to access the Flash from the same script thread. At the time, this worked in Firefox but not Opera - we didn&#039;t initialize the Flash plugin until after the script finished.
<br>
<br>So, we&#039;ve had this bug hanging around saying we should initialize plugin objects immediately when innerHTML is set, and pause the script until the plugin is ready for scripting. Sounds simple? So I thought. Of course it wasn&#039;t.
<br>
<br>At the Toshiba site, they have an OBJECT for IE and an EMBED fallback to load Flash. Both have the same ID. Further they also have a peculiar <strong>#topmovie:after { content: &quot;.&quot;; }</strong> style instruction that affects the object. When JavaScript tries to interact with their Flash content, it hooks up with the wrong object - one that Opera is not going to initialize - and starts waiting until it&#039;s ready for scripting. And while that script is waiting, no other scripts may run - breaking most interaction with the site.
<br>
<br><h2>Updated patches</h2>
<br>
<br><strong>Changed - <a href="http://www.ebay.com">eBay </a>white space to apply on more domain than .com</strong>
<br>According to suggestions in comments on previous post - thanks, guys!
<br>
<br><strong>Changed <a href="http://www.walla.co.il">Walla.co.il</a> styling</strong>
<br>Walla.co.il is improving their standards compliance, making patches obsolete.
<br>
<br><h2>Patches removed for 10.5</h2>
<br>
<br><strong>Removed - <a href="http://www.youtube.com" target="_blank">YouTube</a> menu painting</strong> - site changed
<br>
<br><strong>Removed CORE-17333 - The constructor property of DOM nodes should not be object</strong> - <a href="http://my.opera.com/hallvors/blog/2009/01/08/google-maps-vs-dom2-specification-1-0" target="_blank">this problem</a> now fixed in core
<br>
<br><strong>Removed CORE-17460 - Constructor property of event should be Event interface</strong> - same as above
<br>
<br><strong>Removed CORE-3776 - generic patch for window.scrollX/Y</strong> - implemented these <a href="https://developer.mozilla.org/En/DOM/Window.scrollX" target="_blank">non-standard properties</a>
<br>
<br><strong>Removed - <a href="http://www.expedia.com" target="_blank">expedia.com</a> car rental list</strong>
<br>The issue here was when to encode angle brackets to entities when a site reads innerHTML. Apparently browsers should not do so for certain attributes if the value starts with javascript:. If you want a complex demo of this issue, compare the output from <a href="http://files.myopera.com/hallvors/testcases/CORE-26201.htm" target="_blank">this</a> script in your preferred browsers. Tell me if you find two different browser engines doing exactly the same thing, because I haven&#039;t!
<br>
<br><strong>Removed CORE-25405 - unclickable <a href="http://www.tianya.cn" target="_blank">tianya.cn</a> links</strong> - due to missing OBJECT closing tag (this fix is not actually in 10.5 builds quite yet, but should get there soon)
<br>
<br><strong>Removed - <a href="http://ebay.fr" target="_blank">ebay.fr</a> hangs, select.remove() options</strong> - core fix now landing for the spec violation discussed <a href="http://my.opera.com/hallvors/blog/2009/08/12/browser-js-update-ebay-sun-webmail-salesforce-2" target="_blank">in an earlier browser.js update post</a>
<br>
<br><strong>Removed - <a href="http://www.em.com.cn" target="_blank">em.com.cn</a> menu disappears</strong> - because we didn&#039;t know what order other browsers fired mousemove and mouseout events in when you moved the mouse from one element to another..
<br>
<br><strong>Removed - <a href="http://google.com/reader" target="_blank">Google Reader</a> blank page on &#039;v&#039;</strong> - a peculiar timing problem, I think Reader would try to navigate a popup before we were done loading about:blank.
<br>
<br><strong>Removed - <a href="http://www.picsearch.com" target="_blank">picsearch.com</a>/<a href="http://www.wimbledon.org" target="_blank">wimbledon.org</a>/<a href="http://www.adf.ly" target="_blank">adf.ly</a> loads blank</strong>
<br>Ah. I&#039;ve been <a href="http://dev.opera.com/articles/view/using-capability-detection/" target="_blank">going on</a> about using feature detection rather than browser sniffing and <a href="http://dev.opera.com/articles/view/a-browser-sniffing-warning-the-trouble/" target="_blank">demonstrated</a> how sniffing can cause serious problems. All of a sudden, jQuery <a href="http://docs.jquery.com/Release:jQuery_1.3" target="_blank">releases an update without browser sniffing</a> and it turns out Opera has an unflattering core bug that breaks their feature detection and makes sites that use both FRAMESET and the new jQuery render nothing at all!
<br>
<br>This rather unpleasant discovery depends on the fact that a form element is supposed to be associated with a FORM. A form, on the other hand, is supposed to live inside a document&#039;s BODY. A FRAMESET, on the other hand, will only be rendered if the browser hasn&#039;t seen any BODY at all..
<br>
<br>So, when jQuery runs this somewhat opinionated snippet:
<br>
<br><pre>// Check to see if the browser returns elements by name when 
// querying by getElementById (and provide a workaround) 
var form = document.createElement(&quot;form&quot;), 
id = &quot;why_is_this_needed&quot;; 
form.innerHTML = &#039;&lt;input name=&quot;foo&quot;&gt;&#039;; 
var root = document.documentElement; 
root.insertBefore( form, root.firstChild ); 
root.removeChild( form );</pre>
<br>there was some logic inside Opera thinking: &quot;oops, there&#039;s a form being created here, and we don&#039;t have a BODY, so let&#039;s make one up&quot;. Bizarrely, this code would trigger even if all you did was <strong>document.createElement(&#039;select&#039;)</strong> without inserting <i>anything</i> in the document! A &quot;why_is_this_needed&quot; moment indeed..
<br>
<br>Of course, when we reached the FRAMESET tag Opera ignored it because it had created a BODY for that document already.
<br>
<br>The patch has a certain odd beauty, overwriting createElement() to make sure elements are created inside a fake document until we&#039;ve seen a real BODY or FRAMESET:
<br><pre>document.createElement=(function(createElement){
	var tmpDoc = document.implementation.createDocument(&#039;http://www.w3.org/1999/xhtml/&#039;, &#039;html&#039;, null);
	return function(tagName){
		if( ! document.body ){
			return createElement.call( tmpDoc, tagName );
		}else{
			document.createElement=createElement; // this hack is not necessary anymore
			return createElement.call(this, tagName);
		}
	}
})(document.createElement);</pre>
<br>
<br>Surprisingly, it worked.
<br>
<br><strong>Removed - <a href="http://mail.yahoo.com" target="_blank">Y!Mail</a> chat enter fix</strong> - yes, this patch is being added for 9.x and 10.00/.10 and obsoleted for 10.5 at the same time. We intend to get the core fix that allows certain event listeners in designMode into 10.5, though it&#039;s not in just yet.
<br>
<br><strong>Removed - <a href="http://mail.yahoo.com" target="_blank">Y!Mail</a> XMLDocument usage</strong> - I&#039;m not even sure if we fixed it or they did
<br><strong>Removed - <a href="http://mail.yahoo.com" target="_blank">Y!Mail</a></strong> send button opens attach dialog - Y!Mail had a huge, invisible INPUT type=file and used CSS clip() styling to &quot;cut&quot; away the parts that were above other buttons than &quot;attach&quot;. Unfortunately, Opera sent mouse events even to content that was clipped away.
<br>
<br><strong>Removed - <a href="http://www.allrecipes.com" target="_blank">allrecipes.com</a> byte order marks in JS files</strong> - as <a href="http://my.opera.com/sitepatching/blog/2010/01/11/patches-of-the-week-allrecipes-com-and-ebay-whitespace" target="_blank">promised</a> the <a href="http://en.wikipedia.org/wiki/Mojibake" target="_blank">Mojibake</a> problem is being fixed in core.
<br>
<br><strong>Removed - <a href="http://www.amazon.com.cn" target="_blank">amazon.com.cn</a> menus disappear</strong> - same problem with mouse event order as em.com.cn. The patch was rather tricky to get right..
<br>
<br><strong>Removed - <a href="http://www.asahi.com" target="_blank">asahi.com</a> never stops loading</strong> - one of Japan&#039;s most important news papers was inserting scripts both from timeouts and with document.write() and the mix confused Opera into a never-stops-loading state. We&#039;ve had similar issues elsewhere - <a href="http://www.digg.com" target="_blank">digg.com</a> among other high-profile sites, so this core fix is much appreciated.
<br>
<br><strong>Removed - <a href="http://bbs.pcpop.com" target="_blank">bbs.pcpop.com</a> shows blank</strong> - caused by styling of nested forms (one of these things HTML4 didn&#039;t want to deal with)
<br>
<br><strong>Removed - <a href="http://www.cdon.com" target="_blank">cdon.com</a> shopping cart empty</strong> - a convoluted layout issue with relative position and nested floats.
<br>
<br><strong>Removed CORE-21773 - <a href="http://www.china-pub.com" target="_blank">china-pub.com</a> window.event getter function&#039;s caller property is wrong</strong> - site used an &quot;IE features emulation&quot; script for non-IE browser, defining window.event among other things. Of course we support window.event already, but it was redefined with a getter function anyway, and within that function they tried to read the function&#039;s caller property and exposed a bug.
<br>
<br><strong>Removed DSK-246430 - <a href="http://digg.com" target="_blank">digg.com</a> NSL/no content</strong> - another of these &quot;never stops loading due to peculiar script self-mutations&quot; bugs
<br>
<br><strong>Removed - <a href="http://grainger.com" target="_blank">grainger.com</a> document load</strong> - we <a href="http://my.opera.com/hallvors/blog/2009/05/20/the-day-supporting-document-onload-became-a-bug" target="_blank">realised</a> we should stop supporting document.onload, and now the fix hits the road.
<br>
<br><strong>Removed CORE-10896 - <a href="http://groups.google.com" target="_blank">google groups</a> not 100% tall</strong> - long standing annoyance regarding nested tables with 100% height
<br>
<br><strong>Removed - <a href="http://www.ironmaiden.com" target="_blank">ironmaiden.com</a> disappearing menu</strong> - another mouse event order problem, exacerbated by the especially weird markup and scripting their menu uses. 
<br>
<br><strong>Removed - <a href="http://www.hotmail.com" target="_blank">Hotmail</a> oncontextmenu</strong> - :yes:
<br><strong>Removed - <a href="http://maps.google.com" target="_blank">Google maps</a> oncontextmenu</strong> :yes:
<br><strong>Removed - <a href="http://www.nasdaq.com" target="_blank">nasdaq.com</a> overlapping content</strong> - another layout problem regarding CSS positioning
<br>
<br><strong>Removed - <a href="http://news.sina.com.cn" target="_blank">news.sina.com.cn</a> CDATA parsing</strong> - odd bug where the sheer size of a script element caused it to be split into two text chunks, and the CDATA escape stuff caused a syntax error.
<br>
<br><strong>Removed - <a href="http://photobucket.com" target="_blank">photobucket</a> disappearing menu</strong> - probably also a mouse event order issue
<br>
<br><strong>Removed - <a href="http://picasaweb.google.com" target="_blank">Picasaweb</a> upload button too narrow</strong> - bug in calculations of the width of an element with overflow:hidden, now fixed.
<br>
<br><strong>Removed - <a href="http://www.portalaz.com.br" target="_blank">portalaz.com.br</a> disappearing menus</strong> - mouse event order issue
<br>
<br><strong>Removed - <a href="http://rent.toyota.co.jp" target="_blank">rent.toyota.co.jp</a> window.open issue</strong> - similar to the Reader issue but different. I&#039;m not sure if I ever understood this.
<br>
<br><strong>Removed - <a href="http://www.sfc.jp" target="_blank">sfc.jp</a> noscript content shows</strong> - styling NOSCRIPT elements with display:block turned out to be a bad idea when Opera defaulted to hiding them with a display:none :)
<br>
<br><strong>Removed - <a href="http://www.shutterfly.com" target="_blank">shutterfly.com</a> Array splice on 0-length arrays</strong> - splicing an empty array didn&#039;t work very well in Opera.
<br>
<br><strong>Removed - <a href="http://status.renren.com" target="_blank">status.renren.com</a> missing comments</strong> - same as the CDOn bug
<br>
<br><strong>Removed - <a href="http://www.towerrecords.co.jp" target="_blank">towerrecords.co.jp</a> disappearing menu</strong> - mouse event order problem
<br>
<br><strong>Removed - <a href="http://www.weather.com" target="_blank">weather.com</a> disappearing menu</strong> - mouse event order problem
<br>
<br><strong>Removed - <a href="http://www.wikimapia.org" target="_blank">wikimapia.org</a> oncontextmenu</strong> -  :yes:
<br>
<br><strong>Removed - <a href="http://google.com/finance" target="_blank">Google Finance</a> missing stock details</strong> - a convoluted issue involving Google&#039;s script working around an Opera bug, and the workaround failing for the specific CSS Finance was using.
<br>
<br><strong>Removed - <a href="http://www.pchome.net" target="_blank">pchome.net</a> broke margin</strong> - as stated at the top of the post, already fixed for 10.5
<br>
<br><strong>Removed - <a href="http://zhangmen.baidu.com" target="_blank">zhangmen.baidu.com</a> textarea typing</strong> - we supported IE&#039;s document.selection object without full support for the IE selection APIs. This site (and some others) would detect document.selection and assume the entire API existed. In 10.5 we fix this by removing document.selection support.
<br>
<br>Wow! :hat:</div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}i:4;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:94:"
    <div lang="en" dir="ltr">patches of the week: allrecipes.com and eBay whitespace</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:25:" Hallvord R. M. Steen    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/6382981";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/6382981";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-01-11T19:08:16Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:5730:"<div lang="en" dir="ltr">A new browser.js file is about to go out, the changes are as follows:
<br>
<br><span style="font-size: medium"><strong>Added patches</strong></span>
<br>
<br><strong>allrecipes.com</strong>
<br>
<br><a href="http://allrecipes.com" target="_blank">allrecipes.com search failure fixed</a>, as reported and analysed <a href="http://my.opera.com/community/forums/topic.dml?id=341151" target="_blank">in this forum thread</a>.
<br>
<br>This issue has a deeper history than you&#039;d tell from that discussion though. Yes, we fail to ignore byte order marks in the external script file - but the underlying reason is that <i>Opera doesn&#039;t decode the file as UTF-8, so there is not a byte order mark there - there are some junk characters instead</i>.
<br>
<br>So why doesn&#039;t Opera understand that the <a href="http://images.media-allrecipes.com/js/bundles/main-site.min.js?v=114" target="_blank">external script</a> is UTF-8 encoded? The main site <i>is</i> served as UTF-8 after all..
<br>
<br>Well, one obvious reason is that their script isn&#039;t labelled as UTF-8. Just sending the correct content-type and including the charset - <strong>Content-Type: text/javascript;charset=UTF-8</strong> for example, and we&#039;d be happy to ignore as many BOMs as required. But yet, shouldn&#039;t we be able to guess that a UTF-8 page has encoded its external scripts as UTF-8 too?
<br>
<br>No, for security reasons Opera prior to 10.50 did not let the encoding of the main page affect the interpretation of included content served from a different server. We thought that was the <s>more paranoid</s>safer thing to do, since if something is interpreted with a different encoding than intended, chances are it could turn out to be readable by the wrong site or contribute to maliciousness somehow. And let me tell you: we&#039;re breaking <strong>millions</strong> of sites right now with this policy, usually in minor ways like an ad appearing as <a href="http://en.wikipedia.org/wiki/Mojibake" target="_blank">gobbledygok</a>.
<br>
<br>(One example of a potential exploit - though perhaps not a good one, as how encodings work is not my strongest point - is how Google tends to put <strong>while(1);</strong> as the first line of data when it sends plain JS with private data in it. This line makes the data useless as an included script and is stripped away before GMail and other apps eval() the script. However, if a malicious page managed to load that script into an UTF-7 page and make Opera interpret it as UTF-7, it would be decoded into an entirely different stream of characters and there is a minuscule chance that somehow, that stream of characters might be readable when it shouldn&#039;t be, and that the evil site could decode it back to the actual characters and reveal your private data.)
<br>
<br>I don&#039;t think we&#039;ve ever seen such an attack demonstrated in practise, and now we&#039;ve decided to drop support for UTF-7 (being the most dangerous alternate encoding and virtually unused on the web), and allow external scripts to inherit encoding information even when it comes from a different server. One of 10.5&#039;s most important compat fixes, and the reason why allrecipes.com doesn&#039;t need patching on 10.5 :)
<br>
<br><strong>eBay</strong>
<br>
<br><a href="http://www.ebay.com" target="_blank">eBay</a> auctions should <i>hopefully</i> no longer suffer from huge empty areas in the middle of the page (as <a href="http://my.opera.com/community/forums/topic.dml?id=316241" target="_blank">discussed here</a> and in many other threads over the years.
<br>
<br>This issue was caused by eBay&#039;s script having problems figuring out how large an IFRAME should be. They wanted to make it exactly as tall as the document inside. Initially, in the markup it is actually hardcoded to be 25000 pixels tall (!) and they would use scripts to read the actual size of the document and shrink the IFRAME accordingly.
<br>
<br>The problem is that it&#039;s not all that simple to figure out across browsers and rendering modes what property gives the document&#039;s and what the window&#039;s height. The best reference I know is the table on <a href="http://www.howtocreate.co.uk/tutorials/javascript/browserwindow" target="_blank">howtocreate.co.uk&#039;s article on window dimensions</a>. To complicate matters further, Opera has actually changed the implementation - 9.2x and less tried to align with IE, 9.5x and above tries to align with Firefox/Safari.
<br>
<br>eBay included a quirks mode document in an IFRAME inside a strict mode parent document, and tried to read the &quot;offsetHeight&quot; property from document.body to see how tall the document was. For reasons lost in the annals of history (not really - but I&#039;ll spare you the details) that one returns how tall the <strong>window</strong> is when Opera is in quirks mode. The script would naturally always conclude that the IFRAME was already perfectly sized for its contents, since it was as tall as itself, and no shrinking would happen.
<br>
<br><strong><span style="font-size: medium">Removed patches</span></strong>
<br><span class="imgright"><img alt="" src="http://files.myopera.com/hallvors/blog/buggy.jpg"></span> 
<br>Two patches are also removed this week, one for an animated menu on <a href="http://www.athome.co.jp" target="_blank">athome.co.jp</a> which is now handled in a generic way for all sites using this script, and one for overlapping item in <a href="http://mail.yahoo.com" target="_blank">Yahoo mail</a> search results (as in the image on the right), where we now handle vertical-align styling combined with TABLE tags like Firefox does, and like Yahoo mail expects.</div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}i:5;a:6:{s:4:"data";s:19:"
  
  
  
  
  
  
";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:6:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:46:"
    <div lang="en" dir="ltr">Welcome</div>
  ";s:7:"attribs";a:2:{s:0:"";a:1:{s:4:"type";s:5:"xhtml";}s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}s:6:"author";a:1:{i:0;a:6:{s:4:"data";s:8:"
    
  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"name";a:1:{i:0;a:5:{s:4:"data";s:25:" Hallvord R. M. Steen    ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:4:"href";s:54:"http://my.opera.com/sitepatching/blog/show.dml/6207621";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:2:"id";a:1:{i:0;a:5:{s:4:"data";s:45:"http://my.opera.com/sitepatching/blog/6207621";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"updated";a:1:{i:0;a:5:{s:4:"data";s:20:"2010-01-08T14:04:03Z";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"content";a:1:{i:0;a:5:{s:4:"data";s:720:"<div lang="en" dir="ltr">Welcome to the site patching blog. We&#039;ll cover Opera&#039;s site patching and how we make difficult and broken sites work with tools like <a href="http://www.opera.com/docs/browserjs/" target="_blank">browser.js</a> and automated ID spoofing.
<br>
<br>Some background reading: <a href="http://my.opera.com/core/blog/show.dml/3130540" target="_blank">Opera&#039;s site patching</a> - <a href="http://my.opera.com/operaqa/blog/2008/09/17/you-can-be-a-site-compatibility-wizard" target="_blank">how you can help</a> - <a href="http://my.opera.com/chooseopera/blog/" target="_blank">choose Opera blog</a> - <a href="http://my.opera.com/community/openweb/" target="_blank">Open the Web</a></div>";s:7:"attribs";a:2:{s:36:"http://www.w3.org/XML/1998/namespace";a:1:{s:4:"lang";s:2:"en";}s:0:"";a:1:{s:4:"type";s:5:"xhtml";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:2:"en";}}}}}}}}}}}}s:4:"type";i:512;s:7:"headers";a:4:{s:4:"date";s:29:"Sun, 07 Mar 2010 09:36:28 GMT";s:6:"server";s:75:"Apache/2.2.9 (Debian) mod_apreq2-20051231/2.6.0 mod_perl/2.0.4 Perl/v5.10.0";s:12:"content-type";s:20:"application/atom+xml";s:17:"transfer-encoding";s:7:"chunked";}s:5:"build";i:20081219;}